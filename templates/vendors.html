{% extends "base.html" %}

{% block title %}Vendors - Vendor Management System{% endblock %}

{% block page_title %}Vendor Management{% endblock %}
{% block page_description %}Manage all your vendor relationships{% endblock %}

{% block content %}
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
    <!-- Vendors List -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-building text-primary"></i>
                All Vendors
            </h3>
            <span class="badge badge-primary">{{ vendors|length }} Total</span>
        </div>
        
        {% if vendors %}
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Vendor Name</th>
                            <th>Contact Person</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for vendor in vendors %}
                        <tr>
                            <td>
                                <strong>{{ vendor.name }}</strong>
                                <br><small class="text-muted">{{ vendor.address }}</small>
                            </td>
                            <td>{{ vendor.contact_person }}</td>
                            <td>
                                <a href="tel:{{ vendor.phone }}" class="text-primary">
                                    <i class="fas fa-phone"></i> {{ vendor.phone }}
                                </a>
                            </td>
                            <td>
                                <a href="mailto:{{ vendor.email }}" class="text-primary">
                                    <i class="fas fa-envelope"></i> {{ vendor.email }}
                                </a>
                            </td>
                            <td>
                                {% if vendor.is_active %}
                                    <span class="badge badge-success">Active</span>
                                {% else %}
                                    <span class="badge badge-danger">Inactive</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline btn-sm" onclick="editVendor({{ vendor.id }})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-outline btn-sm" onclick="viewVendorDetails({{ vendor.id }})">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="text-center" style="padding: 40px;">
                <i class="fas fa-building" style="font-size: 3rem; color: var(--text-light); margin-bottom: 16px;"></i>
                <h4>No Vendors Found</h4>
                <p class="text-muted">Start by adding your first vendor using the form on the right.</p>
            </div>
        {% endif %}
    </div>

    <!-- Add New Vendor Form -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-plus text-success"></i>
                Add New Vendor
            </h3>
        </div>
        
        <form method="POST" action="/vendors" id="vendorForm">
            <div class="form-group">
                <label for="name" class="form-label">Vendor Name *</label>
                <input 
                    type="text" 
                    id="name" 
                    name="name" 
                    class="form-control" 
                    required 
                    placeholder="Enter vendor name"
                >
            </div>

            <div class="form-group">
                <label for="contact_person" class="form-label">Contact Person *</label>
                <input 
                    type="text" 
                    id="contact_person" 
                    name="contact_person" 
                    class="form-control" 
                    required 
                    placeholder="Enter contact person name"
                >
            </div>

            <div class="form-group">
                <label for="phone" class="form-label">Phone Number *</label>
                <input 
                    type="tel" 
                    id="phone" 
                    name="phone" 
                    class="form-control" 
                    required 
                    placeholder="Enter phone number"
                >
            </div>

            <div class="form-group">
                <label for="email" class="form-label">Email Address *</label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    class="form-control" 
                    required 
                    placeholder="Enter email address"
                >
            </div>

            <div class="form-group">
                <label for="address" class="form-label">Address *</label>
                <textarea 
                    id="address" 
                    name="address" 
                    class="form-control" 
                    rows="3" 
                    required 
                    placeholder="Enter complete address"
                ></textarea>
            </div>

            <button type="submit" class="btn btn-success" style="width: 100%;">
                <i class="fas fa-plus"></i>
                Add Vendor
            </button>
        </form>
    </div>
</div>

<!-- Vendor Statistics -->
<div class="card" style="margin-top: 20px;">
    <div class="card-header">
        <h3 class="card-title">
            <i class="fas fa-chart-pie text-primary"></i>
            Vendor Statistics
        </h3>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; padding: 20px 0;">
        <div class="text-center">
            <div class="stat-number text-success">{{ vendors|selectattr("is_active")|list|length }}</div>
            <div class="stat-label">Active Vendors</div>
        </div>
        <div class="text-center">
            <div class="stat-number text-warning">{{ vendors|rejectattr("is_active")|list|length }}</div>
            <div class="stat-label">Inactive Vendors</div>
        </div>
        <div class="text-center">
            <div class="stat-number text-primary">{{ vendors|length }}</div>
            <div class="stat-label">Total Vendors</div>
        </div>
        <div class="text-center">
            <div class="stat-number text-primary">
                {% set this_month = vendors|selectattr("created_at")|list %}
                {{ this_month|length if this_month else 0 }}
            </div>
            <div class="stat-label">Added This Month</div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Form validation
    document.getElementById('vendorForm').addEventListener('submit', function(e) {
        const form = e.target;
        const inputs = form.querySelectorAll('input[required], textarea[required]');
        let isValid = true;

        inputs.forEach(input => {
            if (!input.value.trim()) {
                input.style.borderColor = 'var(--danger-color)';
                isValid = false;
            } else {
                input.style.borderColor = 'var(--border-color)';
            }
        });

        if (!isValid) {
            e.preventDefault();
            alert('Please fill in all required fields.');
        }
    });

    // Email validation
    document.getElementById('email').addEventListener('blur', function() {
        const email = this.value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        
        if (email && !emailRegex.test(email)) {
            this.style.borderColor = 'var(--danger-color)';
            this.setCustomValidity('Please enter a valid email address');
        } else {
            this.style.borderColor = 'var(--border-color)';
            this.setCustomValidity('');
        }
    });

    // Phone validation
    document.getElementById('phone').addEventListener('input', function() {
        const phone = this.value.replace(/\D/g, '');
        if (phone.length >= 10) {
            this.style.borderColor = 'var(--success-color)';
        } else {
            this.style.borderColor = 'var(--border-color)';
        }
    });

    // Edit vendor function (placeholder)
    function editVendor(vendorId) {
        alert('Edit vendor functionality will be implemented in the next version.');
    }

    // View vendor details function (placeholder)
    function viewVendorDetails(vendorId) {
        alert('Vendor details view will be implemented in the next version.');
    }

    // Success message after form submission
    if (window.location.search.includes('success')) {
        setTimeout(() => {
            const alert = document.createElement('div');
            alert.className = 'alert alert-success';
            alert.textContent = 'Vendor added successfully!';
            document.querySelector('.main-content').insertBefore(alert, document.querySelector('.main-content').firstChild);
        }, 100);
    }
</script>
{% endblock %} 