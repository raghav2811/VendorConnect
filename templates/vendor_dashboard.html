{% extends "base.html" %}

{% block title %}Vendor Dashboard - {{ vendor.name }}{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-content">
        <div>
            <h1><i class="fas fa-store"></i> Vendor Dashboard</h1>
            <p class="page-subtitle">Manage your business - {{ vendor.name }}</p>
        </div>
        <div class="header-actions">
            {% if not vendor.is_approved %}
                <div class="alert alert-warning" style="margin: 0;">
                    <i class="fas fa-clock"></i> Pending Admin Approval
                </div>
            {% else %}
                <span class="badge badge-success">
                    <i class="fas fa-check-circle"></i> Approved
                </span>
            {% endif %}
        </div>
    </div>
</div>

<!-- Business Overview Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-number">{{ menu_count }}</div>
            <div class="stat-label">Menu Items</div>
        </div>
        <div class="stat-icon">
            <i class="fas fa-utensils"></i>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-number">{{ stock_count }}</div>
            <div class="stat-label">Stock Items</div>
        </div>
        <div class="stat-icon">
            <i class="fas fa-boxes"></i>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-number">0</div>
            <div class="stat-label">Orders Today</div>
        </div>
        <div class="stat-icon">
            <i class="fas fa-shopping-cart"></i>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-number">₹0</div>
            <div class="stat-label">Revenue</div>
        </div>
        <div class="stat-icon">
            <i class="fas fa-rupee-sign"></i>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row" style="margin-top: 30px;">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
            </div>
            <div class="card-body">
                <div class="action-buttons">
                    {% if vendor.is_approved %}
                        <a href="/vendor/menu/add" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus"></i> Add Menu Item
                        </a>
                        <a href="/vendor/stock/add" class="btn btn-success btn-sm">
                            <i class="fas fa-box"></i> Add Stock Item
                        </a>
                        <a href="/vendor/orders" class="btn btn-info btn-sm">
                            <i class="fas fa-list"></i> View Orders
                        </a>
                    {% else %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            Your vendor account is pending approval. You'll be able to add menu items and manage stock once approved by an admin.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-info-circle"></i> Business Information</h3>
            </div>
            <div class="card-body">
                <div class="business-info">
                    <div class="info-item">
                        <strong>Business Type:</strong> {{ vendor.business_type }}
                    </div>
                    <div class="info-item">
                        <strong>Contact:</strong> {{ vendor.contact_person }}
                    </div>
                    <div class="info-item">
                        <strong>Phone:</strong> {{ vendor.phone }}
                    </div>
                    <div class="info-item">
                        <strong>Email:</strong> {{ vendor.email }}
                    </div>
                    <div class="info-item">
                        <strong>Address:</strong> {{ vendor.address }}
                    </div>
                    {% if vendor.description %}
                    <div class="info-item">
                        <strong>Description:</strong> {{ vendor.description }}
                    </div>
                    {% endif %}
                </div>
                <div style="margin-top: 15px;">
                    <a href="/vendor/profile/edit" class="btn btn-outline btn-sm">
                        <i class="fas fa-edit"></i> Edit Profile
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Menu Items -->
{% if menu_items %}
<div class="card" style="margin-top: 30px;">
    <div class="card-header">
        <h3><i class="fas fa-utensils"></i> Your Menu Items</h3>
        {% if vendor.is_approved %}
        <a href="/vendor/menu/add" class="btn btn-primary btn-sm">
            <i class="fas fa-plus"></i> Add Item
        </a>
        {% endif %}
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Price</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in menu_items %}
                    <tr>
                        <td>
                            <strong>{{ item.name }}</strong>
                            <br><small class="text-muted">{{ item.description[:50] }}{% if item.description|length > 50 %}...{% endif %}</small>
                        </td>
                        <td>{{ item.category }}</td>
                                                                          <td>₹{{ item.price }}</td>
                        <td>
                            {% if item.is_available %}
                                <span class="badge badge-success">Available</span>
                            {% else %}
                                <span class="badge badge-danger">Unavailable</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <a href="/vendor/menu/edit/{{ item.id }}" class="btn btn-outline btn-sm">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <button class="btn btn-danger btn-sm" onclick="deleteMenuItem({{ item.id }})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

<!-- Stock Items -->
{% if stock_items %}
<div class="card" style="margin-top: 30px;">
    <div class="card-header">
        <h3><i class="fas fa-boxes"></i> Your Stock Inventory</h3>
        {% if vendor.is_approved %}
        <a href="/vendor/stock/add" class="btn btn-success btn-sm">
            <i class="fas fa-plus"></i> Add Stock
        </a>
        {% endif %}
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Item Name</th>
                        <th>Current Stock</th>
                        <th>Unit</th>
                        <th>Min/Max</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in stock_items %}
                    <tr>
                        <td>
                            <strong>{{ item.item_name }}</strong>
                            <br><small class="text-muted">{{ item.description }}</small>
                        </td>
                        <td>{{ item.current_stock }}</td>
                        <td>{{ item.unit }}</td>
                        <td>{{ item.minimum_stock }} / {{ item.maximum_stock }}</td>
                        <td>
                            {% if item.current_stock <= item.minimum_stock %}
                                <span class="badge badge-danger">Low Stock</span>
                            {% elif item.current_stock <= item.reorder_level %}
                                <span class="badge badge-warning">Reorder</span>
                            {% else %}
                                <span class="badge badge-success">Good</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <a href="/vendor/stock/edit/{{ item.id }}" class="btn btn-outline btn-sm">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="/vendor/stock/transaction/{{ item.id }}" class="btn btn-info btn-sm">
                                    <i class="fas fa-exchange-alt"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

<!-- Recent Activity -->
<div class="card" style="margin-top: 30px;">
    <div class="card-header">
        <h3><i class="fas fa-clock"></i> Recent Activity</h3>
    </div>
    <div class="card-body">
        <div class="activity-list">
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-user-plus"></i>
                </div>
                <div class="activity-content">
                    <strong>Vendor account created</strong>
                    <br><small class="text-muted">{{ vendor.created_at.strftime('%B %d, %Y at %I:%M %p') if vendor.created_at else 'Recently' }}</small>
                </div>
            </div>
            
            {% if vendor.is_approved %}
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-check-circle text-success"></i>
                </div>
                <div class="activity-content">
                    <strong>Vendor approved</strong>
                    <br><small class="text-muted">You can now start selling!</small>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.action-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.business-info .info-item {
    margin-bottom: 10px;
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.business-info .info-item:last-child {
    border-bottom: none;
}

.activity-list .activity-item {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 15px 0;
    border-bottom: 1px solid #eee;
}

.activity-list .activity-item:last-child {
    border-bottom: none;
}

.activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--background-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    color: var(--primary-color);
}

@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .action-buttons .btn {
        width: 100%;
    }
}
</style>

<script>
function deleteMenuItem(itemId) {
    if (confirm('Are you sure you want to delete this menu item?')) {
        // Implementation for deleting menu item
        fetch(`/vendor/menu/delete/${itemId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error deleting menu item');
            }
        });
    }
}
</script>
{% endblock %} 